window.chatta=function(a){function b(a,b){this._elm=document.createElement(a),this._elm.setAttribute("id",b),this._id=b,this._type=a,e.push(this)}function c(a){return this._id=a.id,this.$chattaMssgWrap=new b("div","chatta_mssg_"+this._id),this.$chattaMssgContent=new b("div","chatta_mssg_content_"+this._id),this.$chattaMssgMeta=new b("div","chatta_mssg_meta_"+this._id),this.$chattaMssgWrap.addStyles({margin:a.isRight?"20px 10px 20px 40px":"20px 40px 20px 10px","text-align":a.isRight?"right":"left",background:"#fff","margin-bottom":"10px","-webkit-border-radius":"3px","-webkit-border-radius":"3px","-moz-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px","border-radius":"3px"}),this.$chattaMssgContent.addStyles({padding:"7px 10px"}),this.$chattaMssgMeta.addStyles({"border-top":"1px solid #eee",margin:"0px 10px",padding:"5px 0px","font-size":"9px",color:"#ccc"}),this.$chattaMssgContent.setText(a.content),this.$chattaMssgMeta.setText("Sent by "+a.from+" at "+a.date.format()),this.$chattaMssgWrap.append(this.$chattaMssgContent).append(this.$chattaMssgMeta),this.$chattaMssgWrap}var d=function(){},e=[],f="&#9650;",g="&#9660;";Date.prototype.format=function(){var a=["Sun","Mon","Tues","Weds","Thurs","Fri","Sat"],b=a[this.getDay()],c=this.getHours(),d=this.getMinutes();return c+":"+d+" on "+b},b.prototype.addStyles=function(a){for(var b in a)this._elm.style[b]=a[b]},b.prototype.append=function(a){return this._elm.appendChild(a.getElement()),this},b.prototype.getElement=function(){return this._elm},b.prototype.setText=function(a){this._elm.innerHTML=a},b.prototype.attr=function(a,b){this._elm.setAttribute(a,b)},b.prototype.on=function(a,b){this._elm["on"+a]=b},b.prototype.isValidEmail=function(){var a=this.val(),b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)},b.prototype.animateY=function(a,b){function c(){return h>=i?(b||d)():(h+=1,j._elm.style.bottom=(f-g*h/i).toFixed(0)+"px",void setTimeout(c,5))}function e(a,b){return window.getComputedStyle(a,null).getPropertyValue(b)}var f=parseInt(e(this._elm,"bottom"),10),g=f-a,h=1,i=20,j=this;c()},b.prototype.val=function(a){return"undefined"!=typeof a&&(this._elm.value=a),this._elm.value||!1},b.prototype.height=function(){var a,b,c=this._elm;return document.all?(a=parseInt(c.currentStyle.height.replace("px","")),b=parseInt(c.currentStyle.marginTop,10)+parseInt(c.currentStyle.marginBottom,10)):(a=parseInt(document.defaultView.getComputedStyle(c,"").getPropertyValue("height").replace("px","")),b=parseInt(document.defaultView.getComputedStyle(c,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(c,"").getPropertyValue("margin-bottom"))),a+b},b.find=function(a){for(var b=0;b<e.length;b++)if(e[b]._id===a)return e[b]};var h=new b("div","chatta_wrap"),i=new b("div","chatta_tab"),j=new b("span","chatta_tab_arrow"),k=new b("div","chatta_box"),l=new b("div","chatta_form_wrap"),m=new b("form","chatta_form"),n=new b("input","chatta_email_field"),o=new b("input","chatta_name_field"),p=new b("textarea","chatta_message_box"),q=new b("input","chatta_submit"),r=new b("div","chatta_user_details");j.setText(f),i.setText(a&&a.label||"Chat to the team!"),n.attr("type","text"),n.attr("placeholder","Your email"),o.attr("type","text"),o.attr("placeholder","Your name"),p.attr("placeholder","Your message"),q.attr("type","submit"),q.attr("value","Send"),h.addStyles({width:"400px",background:"#fff",position:"fixed",bottom:"-500px",right:"50px","z-index":"9999","-webkit-border-top-left-radius":"3px","-webkit-border-top-right-radius":"3px","-moz-border-radius-topleft":"3px","-moz-border-radius-topright":"3px","border-top-left-radius":"3px","border-top-right-radius":"3px",overflow:"hidden",display:"none","-webkit-box-shadow":"1px 1px 2px 0px rgba(0,0,0,0.3)","-moz-box-shadow":"1px 1px 2px 0px rgba(0,0,0,0.3)","box-shadow":"1px 1px 2px 0px rgba(0,0,0,0.3)"}),i.addStyles({padding:"10px 20px",background:"#cd5a54",color:"#fff"}),j.addStyles({color:"#fff","float":"right"}),k.addStyles({"max-height":"150px",overflow:"scroll","font-size":"11px",background:"#eee"}),l.addStyles({width:"400px",padding:"10px",bottom:"0px",background:"#fff",left:"0px"});var s={width:"380px",border:"1px solid #eee",background:"#eee","box-shadow":"none","-webkit-border-radius":"3px","-webkit-border-radius":"3px","-moz-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px","border-radius":"3px","margin-bottom":"7px",padding:"3px"};o.addStyles(s),n.addStyles(s),p.addStyles(s),q.addStyles({width:"380px",border:"none","-webkit-border-radius":"3px","-webkit-border-radius":"3px","-moz-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px","border-radius":"3px","margin-bottom":"7px","background-color":"#3b80c1",color:"#fff",top:"0px"}),r.addStyles({"text-align":"center",background:"#36c498",color:"#fff",padding:"4px","font-size":"11px",display:"none"}),i.append(j),h.append(i),h.append(k),m.append(o),m.append(n),m.append(p),m.append(q),l.append(m),h.append(l),h.append(r);var t={_e:h,_isUp:!1};return t.init=function(a){function b(a){c.resetErrorState();var b=c._getFormData(),d=!0;c._messages.length||(d=c._events.initialFormSubmission(b)),d&&c._events.formSubmission(b),p.val(""),a.preventDefault()}var c=this;return document.body.appendChild(this._e.getElement()),this._events={opened:d,closed:d,formSubmission:d,initialFormSubmission:d},this._messages=[],this._user=null,i.on("click",function(){c.toggleBox()}),m.on("submit",b),p.on("keyup",function(a){return a=a||event,13!==a.keyCode||a.ctrlKey?!0:b(a)}),this.display(),this.showTab(!0,function(){a(c)}),c},t._getFormData=function(){var a={};return a.message=p.val(),a.user={name:o.val(),email:n.isValidEmail()&&n.val()},a},t.showTab=function(a,c){var d=this._e.height(),e=b.find("chatta_tab").height();return a!==!1?this._e.animateY(e-d,c):this._e.addStyles({bottom:e-d+"px"}),this},t.setUser=function(a){return this._user=a,this._user.name&&this._user.email?(r.setText("Messaging as "+a.name+" : "+a.email),r.addStyles({display:"block"}),!0):!1},t.getUser=function(){return this._user},t.toggleBox=function(a){var b=this;return b._isUp?this.showTab(!0,function(){j.setText(f),b._isUp=!1,(a||d)()}):b._e.animateY(0,function(){b._isUp=!0,j.setText(g),(a||d)()}),b},t.resetErrorState=function(){return r.addStyles({background:"#36c498",display:"none"}),n.addStyles({border:"1px solid #eee"}),o.addStyles({border:"1px solid #eee"}),this},t.setErrors=function(a,b,c){return r.addStyles({background:"#cd5a54"}),r.setText(a||"Form error"),b&&o.addStyles({border:"1px solid #cd5a54"}),c&&n.addStyles({border:"1px solid #cd5a54"}),r.addStyles({display:"block"}),this},t.display=function(){return this._e.addStyles({display:"block"}),this},t.hide=function(){return this._e.addStyles({display:"none"}),this},t._validateMessage=function(a){var b=!1;return"object"!=typeof a?b=!0:a.hasOwnProperty("from")&&a.hasOwnProperty("content")&&a.hasOwnProperty("date")?a.hasOwnProperty("isRight")||(b=!0):b=!0,b&&console.error("Message is invalid!"),b},t.scrollToBottom=function(){k.getElement().scrollTop=k.getElement().scrollHeight},t.hideUserFields=function(a){n.addStyles({display:a?"none":"block"}),o.addStyles({display:a?"none":"block"})},t.on=function(a,b){this._events[a]=b},t.addMessage=function(a){if(this._validateMessage(a))return this._presentError();a.id=parseInt(1e3*Math.random());var b=new c(a);this.setUser(this._user),k.append(b),this._messages.push(a),this._isUp||this.showTab(!1),this.scrollToBottom()},t}();
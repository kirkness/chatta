window.chatta=function(a){function b(a,b){this._elm=document.createElement(a),this._elm.setAttribute("id",b),this._id=b,this._type=a,e.push(this)}function c(a){return this._id=a.id,this.$chattaMssgWrap=new b("div","chatta_mssg_"+this._id),this.$chattaMssgContent=new b("div","chatta_mssg_content_"+this._id),this.$chattaMssgMeta=new b("div","chatta_mssg_meta_"+this._id),this.$chattaMssgWrap.addStyles({margin:a.isRight?"20px 10px 20px 40px":"20px 40px 20px 10px","text-align":a.isRight?"right":"left",background:"#fff","margin-bottom":"10px","-webkit-border-radius":"3px","-webkit-border-radius":"3px","-moz-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px","border-radius":"3px"}),this.$chattaMssgContent.addStyles({padding:"7px 10px"}),this.$chattaMssgMeta.addStyles({"border-top":"1px solid #eee",margin:"0px 10px",padding:"5px 0px","font-size":"9px",color:"#ccc"}),this.$chattaMssgContent.setText(a.content),this.$chattaMssgMeta.setText("Sent by "+a.from+" at "+a.date.format()),this.$chattaMssgWrap.append(this.$chattaMssgContent).append(this.$chattaMssgMeta),this.$chattaMssgWrap}var d=function(){},e=[],f="&#9650;",g="&#9660;",h=a&&a.widgetWidth||300,i=window.innerWidth>0?window.innerWidth:screen.width,j=a&&a.marginFromRight||50;h+2*j>i&&(j=20,h=i-2*j),function(){for(var a=0,b=["webkit","moz"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),Date.prototype.format=function(){var a=["Sun","Mon","Tues","Weds","Thurs","Fri","Sat"],b=a[this.getDay()],c=this.getHours(),d=this.getMinutes();return c+":"+d+" on "+b},b.prototype.addStyles=function(a){for(var b in a)this._elm.style[b]=a[b]},b.prototype.append=function(a){return this._elm.appendChild(a.getElement()),this},b.prototype.getElement=function(){return this._elm},b.prototype.setText=function(a){this._elm.innerHTML=a},b.prototype.attr=function(a,b){this._elm.setAttribute(a,b)},b.prototype.on=function(a,b){this._elm["on"+a]=b},b.prototype.isValidEmail=function(){var a=this.val(),b=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return b.test(a)},b.prototype.animateY=function(a,b){function c(){return g>=h?(b||d)():(g+=1,i._elm.style.bottom=(e-f*g/h).toFixed(0)+"px",void window.requestAnimationFrame(c))}var e=parseInt(this.css("bottom"),10),f=e-a,g=1,h=20,i=this;c()},b.prototype.css=function(a){return window.getComputedStyle(this._elm,null).getPropertyValue(a)},b.prototype.val=function(a){return"undefined"!=typeof a&&(this._elm.value=a),this._elm.value||!1},b.prototype.height=function(){var a,b,c=this._elm;return document.all?(a=parseInt(c.currentStyle.height.replace("px","")),b=parseInt(c.currentStyle.marginTop,10)+parseInt(c.currentStyle.marginBottom,10)):(a=parseInt(document.defaultView.getComputedStyle(c,"").getPropertyValue("height").replace("px","")),b=parseInt(document.defaultView.getComputedStyle(c,"").getPropertyValue("margin-top"))+parseInt(document.defaultView.getComputedStyle(c,"").getPropertyValue("margin-bottom"))),a+b},b.find=function(a){for(var b=0;b<e.length;b++)if(e[b]._id===a)return e[b]};var k=new b("div","chatta_wrap"),l=new b("div","chatta_tab"),m=new b("span","chatta_tab_text"),n=new b("span","chatta_tab_arrow"),o=new b("div","chatta_box"),p=new b("div","chatta_form_wrap"),q=new b("form","chatta_form"),r=new b("input","chatta_email_field"),s=new b("input","chatta_name_field"),t=new b("textarea","chatta_message_box"),u=new b("input","chatta_submit"),v=new b("div","chatta_user_details"),w=new b("span","chatta_light");n.setText(f),m.setText(a&&a.label||"Chat to the team!"),r.attr("type","text"),r.attr("placeholder","Your email"),s.attr("type","text"),s.attr("placeholder","Your name"),t.attr("placeholder","Your message"),u.attr("type","submit"),u.attr("value","Send"),k.addStyles({width:h+"px",background:"#fff",position:"fixed",bottom:"-500px",right:j+"px","z-index":"9999","-webkit-border-top-left-radius":"3px","-webkit-border-top-right-radius":"3px","-moz-border-radius-topleft":"3px","-moz-border-radius-topright":"3px","border-top-left-radius":"3px","border-top-right-radius":"3px",overflow:"hidden",display:"none","-webkit-box-shadow":"1px 1px 2px 0px rgba(0,0,0,0.3)","-moz-box-shadow":"1px 1px 2px 0px rgba(0,0,0,0.3)","box-shadow":"1px 1px 2px 0px rgba(0,0,0,0.3)"}),l.addStyles({padding:"10px 20px",background:a.tabColor||"#cd5a54",color:"#fff"}),w.addStyles({background:a.chattaActiveColor||"#36c498","margin-right":"10px",width:"10px",height:"10px",display:"inline-block","border-radius":"25px","margin-top":"5px"}),n.addStyles({color:"#fff","float":"right"}),o.addStyles({"max-height":"150px",overflow:"scroll","font-size":"11px",background:"#eee"}),p.addStyles({width:h+"px",padding:"10px",bottom:"0px",background:"#fff",left:"0px"});var x={width:h-20+"px",border:"1px solid #eee",background:"#eee","box-shadow":"none","-webkit-border-radius":"3px","-webkit-border-radius":"3px","-moz-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px","border-radius":"3px","margin-bottom":"7px",padding:"3px"};s.addStyles(x),r.addStyles(x),t.addStyles(x),u.addStyles({width:h-20+"px",border:"none","-webkit-border-radius":"3px","-webkit-border-radius":"3px","-moz-border-radius":"3px","-moz-border-radius":"3px","border-radius":"3px","border-radius":"3px","margin-bottom":"7px","background-color":a.btnColor||"#3b80c1",padding:"7px 0px",color:"#fff",top:"0px"}),v.addStyles({"text-align":"center",background:a.userDetailsFooterColor||"#36c498",color:"#fff",padding:"4px","font-size":"11px",display:"none"}),l.append(w),l.append(m),l.append(n),k.append(l),k.append(o),q.append(s),q.append(r),q.append(t),q.append(u),p.append(q),k.append(p),k.append(v);var y={_e:k,_isUp:!1};return y.init=function(a){function b(a){if(c._events.anySubmission(a),!this.connectionError){c.resetErrorState();var b=c._getFormData(),d=!0;c._messages.length||(d=c._events.initialFormSubmission(b)),d&&c._events.formSubmission(b),a.preventDefault()}}var c=this;return document.body.appendChild(this._e.getElement()),this._events={opened:d,closed:d,formSubmission:d,initialFormSubmission:d,mssgKeyup:d,emailKeyup:d,nameKeyup:d,anySubmission:d},this._messages=[],this._user=null,l.on("click",function(){c.toggleBox()}),q.on("submit",b),r.on("keyup",this._events.emailKeyup),s.on("keyup",this._events.nameKeyup),t.on("keyup",function(a){return a=a||event,this._events.mssgKeyup(a),13!==a.keyCode||a.ctrlKey?!0:b(a)}),this.display(),this.showTab(!0,function(){a(c)}),c},y._getFormData=function(){var a={};return a.message=t.val(),a.message=a.message.replace(/(?:\r\n|\r|\n)/g,""),a.user={name:s.val(),email:r.isValidEmail()&&r.val()},a},y.showTab=function(a,c){var d=this._e.height(),e=b.find("chatta_tab").height();return a!==!1?this._e.animateY(e-d,c):this._e.addStyles({bottom:e-d+"px"}),this},y.setUser=function(a){return this._user=a,this._user.name&&this._user.email?(v.setText("Messaging as "+a.name+" : "+a.email),v.addStyles({display:"block"}),!0):!1},y.getUser=function(){return this._user},y.clearMessageBox=function(){t.val("")},y.toggleBox=function(a){var b=this;return b._isUp?this.showTab(!0,function(){n.setText(f),b._isUp=!1,(a||d)()}):b._e.animateY(0,function(){b._isUp=!0,n.setText(g),(a||d)()}),b},y.resetErrorState=function(){return v.addStyles({background:a.userDetailsFooterColor||"#36c498",display:"none"}),r.addStyles({border:"1px solid #eee"}),s.addStyles({border:"1px solid #eee"}),this},y.setErrors=function(b,c,d){return v.addStyles({background:a.errorColor||"#cd5a54"}),v.setText(b||"Form error"),c&&s.addStyles({border:"1px solid "+(a.errorColor||"#cd5a54")}),d&&r.addStyles({border:"1px solid "+(a.errorColor||"#cd5a54")}),v.addStyles({display:"block"}),this},y.display=function(){return this._e.addStyles({display:"block"}),this},y.hide=function(){return this._e.addStyles({display:"none"}),this},y._validateMessage=function(a){var b=!1;return"object"!=typeof a?b=!0:a.hasOwnProperty("from")&&a.hasOwnProperty("content")&&a.hasOwnProperty("date")?a.hasOwnProperty("isRight")||(b=!0):b=!0,b&&console.error("Message is invalid!"),b},y.scrollToBottom=function(){o.getElement().scrollTop=o.getElement().scrollHeight},y.hideUserFields=function(a){r.addStyles({display:a?"none":"block"}),s.addStyles({display:a?"none":"block"})},y.on=function(a,b){this._events[a]=b},y.setFormError=function(b,c){b?(this.connectionError=!0,u.attr("value",c||"Error!"),u.addStyles({background:a.errorColor||"#cd5a54",opacity:"0.7"}),u.getElement().disabled=!0):(u.attr("value","Send"),this.connectionError=!1,u.addStyles({background:a.btnColor||"#3b80c1",opacity:"1"}),u.getElement().disabled=!1)},y._countOccuranceOf=function(a,b){for(var c=0,d=0;d<a.length;d++)c=b(a[d])?c+1:c;return c},y.getTotalMessages=function(a){return"undefined"==typeof a?this._messages.length:this._countOccuranceOf(this._messages,function(b){return a&&b.isRight||!b.isRight})},y.addMessage=function(a){if(this._validateMessage(a))return this._presentError();a.id=parseInt(1e3*Math.random());var b=new c(a);this.setUser(this._user),o.append(b),this._messages.push(a),this._isUp||this.showTab(!1),this.scrollToBottom()},y};